var a={},b={},c,d='<li><span class="name"></span><time class="timeago"></time><span class="search_str"></span></li>',e={active_note:0,notes_arr:[{title:"About this app",date:"1295308437988",text:'This is a simulation of the Notes app. \nThis demo uses localstorage to store your notes, so the next time you open it, they will be here ;)\nIf you want to store your notes, click "allow" when your browser prompts you.'},{title:"Working apps",date:"1295308434988",text:"working apps :\n\n - safari \n\n - google maps \n\n - everytimezone \n\n - notes \n\n - hnreader"}]};$("#notes_list li").live("click",function(){$("#note_area").focusout();a.textAreaPopulate(+$(this).data("id"),this)});$("#note_area").live("change keyup keydown focusout",function(d){b.notes_arr[b.active_note].text=this.value;b.notes_arr[b.active_note].title=this.value.substring(0,17);$(".active .name,#main_title").removeClass("default").html(b.notes_arr[b.active_note].title);if(this.value!=""){clearTimeout(c);c=setTimeout(a.updateLocalStorage,500)}else this.value==""&&d.type!="focusout"?$(".active .name,#main_title").html("New note").addClass("default"):d.type=="focusout"&&a.removeNote()});$("#add_btn").live("click",function(){a.addNewNote()});$("#remove_btn.enabled").live("click",function(){var b=confirm("Delete this note?");b&&a.removeNote()});$("#prev.enabled").live("click",function(){a.textAreaPopulate(b.active_note-1)});$("#next.enabled").live("click",function(){a.textAreaPopulate(b.active_note+1)});$("#text").live("focusin focusout keyup keydown",function(a){switch(a.type){case"keyup":case"keydown":if(this.value!=""){$("#notes_list").addClass("filtered");$("#number").html($("#notes_list li.show").length)}else{$("#notes_list").removeClass("filtered");$("#number").html($("#notes_list li").length)}break;case"focusout":default:$("#notes_list").removeClass("filtered")}});$("document").ready(function(){notes_from_ls=a.getObject("notes");b=notes_from_ls&&notes_from_ls.notes_arr.length>0?notes_from_ls:e;b.active_note>b.notes_arr.length-1&&(b.active_note=0);$.each(b.notes_arr,function(c,e){_temp=$(d).data("id",c);$(".name",_temp).html(e.title);$("time",_temp).html($.timeago(new Date(+e.date)));$(".search_str",_temp).html(e.text);if(c==b.active_note){a.textAreaPopulate(c);$(_temp).addClass("active")}_temp.appendTo("#notes_list")});$("#text").liveUpdate($("#notes_list"));$("#number").html(b.notes_arr.length);note_list=new iScroll("notes_list",{momentum:!0,desktopCompatibility:!0,hScrollbar:!0})});a.addNewNote=function(){var c=new Date,e={title:"New Note",date:c.getTime(),text:""},f=$(d),g=b.notes_arr.unshift(e);$(".name",f).html(e.title);$("time",f).html($.timeago(new Date(+e.date)));f.data("id",0).css("height",0).prependTo("#notes_list").animate({height:36},500,function(){a.refreshIDs();a.textAreaPopulate(0);$("#number").html(b.notes_arr.length)})};a.removeNote=function(c){var d=c!==undefined?c:b.active_note;$("#notes_list li").eq(d).animate({height:0},500,function(){$(this).remove();b.notes_arr.remove(d);e.active_note=0;a.refreshIDs();a.textAreaPopulate();$("#number").html(b.notes_arr.length)})};a.updateLocalStorage=function(){a.setObject("notes",b)};a.refreshIDs=function(){$("#notes_list li").each(function(a){$(this).data("id",a)})};a.updateBtns=function(){$("#prev,#next,#remove_btn").removeClass("enabled");b.notes_arr.length>1&&$("#remove_btn").addClass("enabled");b.active_note>0&&b.notes_arr.length>1&&$("#prev").addClass("enabled");b.active_note<b.notes_arr.length-1&&b.notes_arr.length>1&&$("#next").addClass("enabled")};a.textAreaPopulate=function(c,d){var f=c||e.active_note;b.active_note=f;$("#note_area").attr("value",b.notes_arr[f].text).focus();$("#main_title").html(b.notes_arr[f].title);var g=new Date(+b.notes_arr[f].date);$("#relative_date").html($.timeago(g));$("#date_time").html(g.toLocaleDateString()+" "+g.getDate());$("#notes_list li").eq(f).addClass("active").siblings().removeClass("active");a.updateLocalStorage();a.updateBtns()};a.setObject=function(a,b){localStorage.setItem(a,JSON.stringify(b))};a.getObject=function(a){return localStorage.getItem(a)&&JSON.parse(localStorage.getItem(a))};Array.prototype.remove=function(a,b){var c=this.slice((b||a)+1||this.length);this.length=a<0?this.length+a:a;return this.push.apply(this,c)};